#!/usr/bin/env bash
set -euo pipefail

root_dir="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"

required_files=(
  "${root_dir}/README.md"
  "${root_dir}/STATUS.md"
  "${root_dir}/PHASE-0.md"
  "${root_dir}/docs/system-brief.md"
  "${root_dir}/.bridges/protocols/signal-format.yaml"
  "${root_dir}/tools/plan-registry/plans.yaml"
  "${root_dir}/tools/state-tracker/state.yaml"
  "${root_dir}/tools/dependency-graph/graph.yaml"
  "${root_dir}/scripts/autofile"
  "${root_dir}/scripts/build-distro.sh"
  "${root_dir}/scripts/verify-distro.sh"
  "${root_dir}/scripts/health.sh"
  "${root_dir}/scripts/backup.sh"
  "${root_dir}/scripts/restore.sh"
  "${root_dir}/scripts/orchestrate"
  "${root_dir}/scripts/signal"
  "${root_dir}/tools/autofile/autofile.py"
  "${root_dir}/tools/autofile/README.md"
  "${root_dir}/tools/orchestrator/orchestrator.py"
  "${root_dir}/tools/orchestrator/README.md"
  "${root_dir}/tools/signal/signal.py"
  "${root_dir}/tools/signal/README.md"
  "${root_dir}/scripts/work"
  "${root_dir}/tools/work/work.py"
  "${root_dir}/tools/work/README.md"
  "${root_dir}/docs/tracking.md"
  "${root_dir}/docs/deploy/ionos-iso.md"
  "${root_dir}/docs/deploy/iso-build.md"
  "${root_dir}/docs/deploy/image-spec.md"
  "${root_dir}/docs/decisions/0002-iso-build-approach.md"
  "${root_dir}/docs/decisions/0003-ionos-target.md"
  "${root_dir}/docs/templates/bug.md"
  "${root_dir}/docs/templates/issue.md"
  "${root_dir}/docs/templates/dead-end.md"
  "${root_dir}/docs/templates/stub.md"
  "${root_dir}/scripts/build-iso.sh"
  "${root_dir}/scripts/deploy/install-asf.sh"
  "${root_dir}/scripts/deploy/build-debian-preseed-iso.sh"
  "${root_dir}/scripts/deploy/repack-debian-iso.py"
  "${root_dir}/scripts/deploy/preseed.cfg"
  "${root_dir}/docs/context-protocol.md"
  "${root_dir}/docs/security/secret-handling.md"
  "${root_dir}/docs/ops/health-model.md"
  "${root_dir}/docs/ops/synthesis.md"
  "${root_dir}/docs/ops/focus.md"
  "${root_dir}/docs/ops/focus-modes.md"
  "${root_dir}/docs/odyssey-5000y.md"
  "${root_dir}/docs/elemental-matrix.md"
  "${root_dir}/docs/oxygen-protocol.md"
  "${root_dir}/docs/life-systems.md"
  "${root_dir}/docs/beryllium-scheme.md"
  "${root_dir}/docs/carbon-scheme.md"
  "${root_dir}/docs/water-scheme.md"
  "${root_dir}/docs/atomic-lattice.md"
  "${root_dir}/docs/periodic-table-protocol.md"
  "${root_dir}/docs/atomic-autonomy.md"
  "${root_dir}/.substrate/constants/budgets.yaml"
  "${root_dir}/docs/orthogonal-periodic-table.md"
  "${root_dir}/scripts/oxygen"
  "${root_dir}/tools/oxygen/oxygen.py"
  "${root_dir}/tools/oxygen/README.md"
  "${root_dir}/.substrate/state/leases/README.md"
  "${root_dir}/docs/orchestration-field.md"
  "${root_dir}/.pantheon/observers/knower.md"
  "${root_dir}/docs/quantum-convergence.md"
  "${root_dir}/scripts/field"
  "${root_dir}/tools/field/field.py"
  "${root_dir}/tools/field/orthogonal-table.json"
  "${root_dir}/docs/templates/context-capsule.md"
  "${root_dir}/scripts/context"
  "${root_dir}/tools/context/context.py"
  "${root_dir}/tools/context/README.md"
  "${root_dir}/scripts/synthesize"
  "${root_dir}/tools/synthesis/synthesis.py"
  "${root_dir}/tools/synthesis/README.md"
  "${root_dir}/scripts/focus"
  "${root_dir}/tools/focus/focus.py"
  "${root_dir}/tools/focus/README.md"
  "${root_dir}/tools/focus/levels.json"
  "${root_dir}/docs/math/orthobreak.md"
  "${root_dir}/docs/math/tsp-lab.md"
  "${root_dir}/docs/math/mathwatch.md"
  "${root_dir}/scripts/tsp"
  "${root_dir}/tools/qai/tsp.py"
  "${root_dir}/tools/qai/README.md"
  "${root_dir}/scripts/mathwatch"
  "${root_dir}/tools/mathwatch/mathwatch.py"
  "${root_dir}/tools/mathwatch/feeds.json"
  "${root_dir}/scripts/sciencewatch"
  "${root_dir}/tools/sciencewatch/sciencewatch.py"
  "${root_dir}/tools/sciencewatch/feeds.json"
  "${root_dir}/docs/science/sciencewatch.md"
  "${root_dir}/docs/ops/socials.md"
  "${root_dir}/artifacts/socials/README.md"
  "${root_dir}/scripts/blogwatch"
  "${root_dir}/tools/blogwatch/blogwatch.py"
  "${root_dir}/tools/blogwatch/README.md"
  "${root_dir}/docs/watch/blogwatch.md"
  "${root_dir}/docs/watch/githubwatch.md"
  "${root_dir}/docs/publish/convergent-intelligence.md"
  "${root_dir}/docs/publish/daily-release.md"
  "${root_dir}/docs/publish/policy.md"
  "${root_dir}/qwen.md"
  "${root_dir}/sites/convergent-intelligence/README.md"
  "${root_dir}/sites/convergent-intelligence/app/README.md"
  "${root_dir}/tools/blogwatch/domains/mathematics.json"
  "${root_dir}/tools/blogwatch/domains/computer_science.json"
  "${root_dir}/tools/blogwatch/domains/physics.json"
  "${root_dir}/tools/blogwatch/domains/chemistry.json"
  "${root_dir}/tools/blogwatch/domains/biology.json"
  "${root_dir}/tools/blogwatch/domains/medicine.json"
  "${root_dir}/tools/blogwatch/domains/neuroscience.json"
  "${root_dir}/tools/blogwatch/domains/earth_science.json"
  "${root_dir}/tools/blogwatch/domains/engineering.json"
  "${root_dir}/tools/blogwatch/domains/general_science.json"
  "${root_dir}/scripts/githubwatch"
  "${root_dir}/tools/githubwatch/githubwatch.py"
  "${root_dir}/tools/githubwatch/README.md"
  "${root_dir}/tools/githubwatch/domains/computer_science.json"
  "${root_dir}/scripts/daily"
  "${root_dir}/scripts/publish"
  "${root_dir}/tools/publish/daily.py"
  "${root_dir}/tools/publish/publish.py"
  "${root_dir}/tools/publish/README.md"
  "${root_dir}/scripts/reward"
  "${root_dir}/tools/rewards/reward.py"
  "${root_dir}/docs/web3/overview.md"
  "${root_dir}/docs/web3/siwe.md"
  "${root_dir}/docs/web3/brave.md"
  "${root_dir}/docs/web3/rewards.md"
  "${root_dir}/docs/web3/proofs.md"
  "${root_dir}/docs/security/web3-threat-model.md"
  "${root_dir}/docs/governance/overview.md"
  "${root_dir}/scripts/proof"
  "${root_dir}/tools/proofs/proof.py"
  "${root_dir}/tools/proofs/README.md"
)

missing=0
for f in "${required_files[@]}"; do
  if [[ ! -f "${f}" ]]; then
    printf "missing: %s\n" "${f}" >&2
    missing=1
  fi
done

if [[ "${missing}" -ne 0 ]]; then
  exit 1
fi

printf "ok: scaffold validates (%s)\n" "${root_dir}"
